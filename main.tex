\documentclass{beamer}
\usetheme{metropolis}
\usepackage[utf8]{inputenc}

\metroset{block=fill}

\usepackage{underscore}           % Only needed if you use pdflatex.

\usepackage{amsthm}

\newtheorem{dfn}{Definition}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{braket}
\usepackage{fancyhdr}
\usepackage{booktabs}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{regexpatch}
\usepackage{letltxmacro}
\usepackage{aligned-overset}

\usepackage{hyperref}
\usepackage[noabbrev,nameinlink]{cleveref}

\usepackage{enumitem}

\usepackage{xspace}

\usepackage{nowidow}
\usepackage{microtype}

\usepackage{float}
\usepackage{caption}
\usepackage{subcaption}

\usepackage{xcolor}
%\newcommand{\todo}[1]{{\color{red}\textbf{#1}}}{}


\usepackage{cancel}

\usepackage{algorithm}
\usepackage[noend]{algpseudocode}

\usepackage{wrapfig}

\usepackage{svg}

\usepackage{tikz}

\usetikzlibrary{backgrounds}
\usetikzlibrary{arrows}
\usetikzlibrary{shapes,shapes.geometric,shapes.misc}
\usetikzlibrary{decorations.pathmorphing}
\usetikzlibrary{decorations.pathreplacing}
\usetikzlibrary{decorations.markings}

\tikzstyle{every picture}=[baseline=-0.25em,scale=0.5]

\pgfkeys{/tikz/tikzit fill/.initial=0}
\pgfkeys{/tikz/tikzit draw/.initial=0}
\pgfkeys{/tikz/tikzit shape/.initial=0}
\pgfkeys{/tikz/tikzit category/.initial=0}

\newcommand{\tikzfig}[1]{%
\IfFileExists{#1.tikz}
  {\input{#1.tikz}}
  {%
    \IfFileExists{./figures/#1.tikz}
      {\input{./figures/#1.tikz}}
      {\tikz[baseline=-0.5em]{\node[draw=red,font=\color{red},fill=red!10!white] {\textit{#1}};}}%
  }%
}
\newcommand{\ctikzfig}[1]{%
\begin{center}\rm
  \tikzfig{#1}
\end{center}}

\newcommand{\oftype}[2]{\text{#1}\,:\,\text{#2}}
\newcommand{\ZX}[2]{\texttt{ZX}\,\,\text{#1}\,\,\text{#2}}
\newcommand{\nat}{\texttt{nat}}

\newcommand{\VyZX}{\textsl{Vy}\textsc{ZX}\xspace}
\newcommand{\SQIR}{\textsc{sqir}\xspace}
\newcommand{\QASM}{\texttt{QASM}\xspace}
\newcommand{\QLib}{\texttt{QuantumLib}\xspace}
\newcommand{\pyZX}{PyZX\xspace}
\newcommand{\VOQC}{\textsc{Voqc}\xspace}
\newcommand{\QWIRE}{\texttt{QWIRE}\xspace}
\newcommand{\inQWIRE}{\texttt{inQWIRE}\xspace}
\newcommand{\certiq}{\texttt{CertiQ}\xspace}
\newcommand{\tket}{\texttt{t\(\ket{\text{ket}}\)}\xspace}
\newcommand{\quartz}{Quartz\xspace}

% links formatting
\hypersetup{
    colorlinks,
    linkcolor={red!50!black},
    citecolor={blue!50!black},
    urlcolor={blue!80!black}
}


\usepackage{mathpartir}
% Comments
\usepackage{etoolbox}

\definecolor{egreen}{rgb}{0.31, 0.78, 0.47}
\definecolor{ate}{rgb}{0.58, 0.0, 0.83}
\newtoggle{revision}
%\toggletrue{revision}
\togglefalse{revision}

\iftoggle{revision}{
    \newcommand{\rnr}[1]{\textit{\textcolor{blue}{Robert: #1}}}
    \newcommand{\ael}[1]{\textit{\textcolor{purple}{Adrian: #1}}}
    \newcommand{\ben}[1]{\textit{\textcolor{egreen}{Ben: #1}}}
    \newcommand{\todo}[1]{\textit{\textcolor{red}{TODO: #1}}}
    %%%% Refcheck
    
    \usepackage{refcheck}
    
    %%% Infrastructure    
    \makeatletter
    \newcommand{\refcheckize}[1]{%
      \expandafter\let\csname @@\string#1\endcsname#1%
      \expandafter\DeclareRobustCommand\csname relax\string#1\endcsname[1]{%
        \csname @@\string#1\endcsname{##1}\wrtusdrf{##1}}%
      \expandafter\let\expandafter#1\csname relax\string#1\endcsname
    }
    \makeatother
    %%%
    
    %%% Now we add the reference commands we want refcheck to be aware of
    \refcheckize{\cref}
    \refcheckize{\Cref}
}{
    \newcommand{\rnr}[1]{}
    \newcommand{\ael}[1]{}
    \newcommand{\ben}[1]{}
    \newcommand{\todo}[1]{}
}


\newcommand{\R}{\mathbb{R}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\N}{\mathbb{N}}

\pgfdeclarelayer{edgelayer}
\pgfdeclarelayer{nodelayer}
\pgfsetlayers{background, edgelayer, nodelayer, main}
\tikzstyle{none}=[inner sep=0mm]
\tikzstyle{every loop}=[]
\tikzstyle{mark coordinate}=[inner sep=0pt,outer sep=0pt,minimum size=3pt,fill=black,circle]
\input{zh.tikzdefs}
\input{zh.tikzstyles}


\algnewcommand\algorithmicswitch{\textbf{switch}}
\algnewcommand\algorithmiccase{\textbf{case}}
\algnewcommand\algorithmicassert{\texttt{assert}}

\algdef{SE}[SWITCH]{Switch}{EndSwitch}[1]{\algorithmicswitch\ #1\ \algorithmicdo}{\algorithmicend\ \algorithmicswitch}%
\algdef{SE}[CASE]{Case}{EndCase}[1]{\algorithmiccase\ #1}{\algorithmicend\ \algorithmiccase}%
\algtext*{EndSwitch}%
\algtext*{EndCase}%

\makeatletter
\def\blfootnote{\gdef\@thefnmark{}\@footnotetext}
\makeatother

\newcommand{\mailtodomain}[1]{\href{mailto:#1}{\nolinkurl{#1}}}

\newcommand{\titletext}{\VyZX : A Vision for Verifying the ZX Calculus}

\title{\VyZX}
\subtitle{A Vision for \alert{Verifying the ZX Calculus}}
\author{\textbf{Adrian Lehmann} \and \textbf{Benjamin Caldwell} \and Robert Rand}
\institute{Department of Computer Science \\ University of Chicago\\
\\
\tiny
This work is supported by EPiQC, an NSF Expedition in Computing, under Grant
No. CCF-1730449 and the Air Force Office of Scientific Research under Grant No. FA95502110051.}
\date{}

\begin{document}

\maketitle

\begin{frame}{Why Verify?}

  The \alert{ZX Calculus} has proven itself a valuable intermediate representation for quantum programs. In particular, \pyZX has proven the ZX calculus as an IR for quantum program optimization [Duncan et al.]. \pause
    
    In \alert{optimization} passes we would like to guarantee a \alert{preservation of semantics} for our quantum circuit.\pause
    
    Common practices such as unit testing, SMT-based verification, or translation validation can't verify every optimization is correct.\pause
    
    Verification can give us these guarantees which are useful for quantum programming [Hietala et al].
    
\end{frame}

\begin{frame}{Approaching Verification}

    Verification requires the right \alert{data structures}: Proof assistants work well with \alert{inductive} data structures and poorly with dictionaries or maps.\\\pause
    We adapt \alert{string diagrams} inductively:
    
    \begin{figure}

            \begin{subfigure}{.6\textwidth}
                \tikzfig{compose_string}
                \qquad
                \tikzfig{parallel_string}
            \end{subfigure}
            
            \begin{subfigure}{.5\textwidth}
                \tikzfig{swap_string}
                \qquad
                \tikzfig{cap}
                \quad
                \tikzfig{cup}
            \end{subfigure}
        
        
        \label{fig:string}
    \end{figure}
    
\end{frame}

\begin{frame}{Inductive ZX Diagrams}
    
    To define our ZX diagrams, we take these string diagram constructions and \alert{add Z and X spiders}.
    \pause
    \begin{figure}[t]
    \centering
            
            \begin{subfigure}{.4\textwidth}
            \inferrule
            {\oftype{in out}{\(\N\)} \and \oftype{\(\alpha\)}{\(\R\)}}
            {\oftype{\texttt{Z_Spider} in out \(\alpha\)}{\ZX{in}{out}}}
            \end{subfigure}\hfill\begin{subfigure}{.4\textwidth}
            \inferrule
            {\oftype{in out}{\(\N\)} \and \oftype{\(\alpha\)}{\(\R\)}}
            {\oftype{\texttt{X_Spider} in out \(\alpha\)}{\ZX{in}{out}}}
            \end{subfigure}
            \pause
            \begin{subfigure}{.25\textwidth}
            \inferrule{ }{\oftype{\texttt{Cap}}{\ZX{0}{2}}}
            \end{subfigure}\hfill\begin{subfigure}{.25\textwidth}
            \inferrule{ }{\oftype{\texttt{Cup}}{\ZX{2}{0}}}
            \end{subfigure}\hfill\begin{subfigure}{.25\textwidth}
            \inferrule{ }{\oftype{\texttt{Swap}}{\ZX{2}{2}}}
            \end{subfigure}\hfill\begin{subfigure}{.25\textwidth}
            \inferrule{ }{\oftype{\texttt{Empty}}{\ZX{0}{0}}}
            \end{subfigure}
            \pause
            \begin{subfigure}{.4\textwidth}
            \inferrule
            {\oftype{zx1}{\ZX{in}{mid}} \and \oftype{zx2}{\ZX{mid}{out}}}
            {\oftype{\texttt{Compose} zx1 zx2}{\ZX{in}{out}}}
            \end{subfigure}\hfill\begin{subfigure}{.4\textwidth}
            \inferrule
            {\oftype{zx1}{\ZX{in1}{out1}} \and \oftype{zx2}{\ZX{in2}{out2}}}
            {\oftype{\texttt{Stack} zx1 zx2}{\ZX{(in1 + in2)}{(out1 + out2)}}}
            \end{subfigure}

        \label{fig:blockconstructors}
    \end{figure}
\end{frame}

\begin{frame}{Semantics}

  To verify transformations on diagrams, we introduce a \alert{system of semantics} based on \QLib\footnote{\texttt{https://github.com/inQWIRE/QuantumLib}}.
    %a mathematical library specialized for quantum computing.
    
    \ben{Semantic maps for diagram pieces to their matrix notations}
    \begin{align*}
        \texttt{Z_Spider n m }\alpha \quad &\mapsto \hspace{47pt}
        \begin{bmatrix} 
            1 & \dotsi & 0 \\ 
            \vdots & \ddots & 0 \\ 
            0 & 0 & e^{i\alpha}
        \end{bmatrix}
    \\
    \texttt{X_Spider n m }\alpha  \quad &\mapsto \quad H^{\otimes m} \times 
        \begin{bmatrix} 
            1 & \dotsi & 0 \\ 
            \vdots & \ddots & 0 \\ 
            0 & 0 & e^{i\alpha}
        \end{bmatrix} \times H^{\otimes n}
    \end{align*}
\end{frame}
    
\begin{frame}{More Semantics}
    \begin{align*}
        \texttt{Cap} &\mapsto 
        \begin{bmatrix} 
            1 & 0 & 0 & 1
        \end{bmatrix}
    \\
        \texttt{Cup} &\mapsto 
        \begin{bmatrix} 
            1 & 0 & 0 & 1
        \end{bmatrix}^\top
    \\
        \texttt{Swap} &\mapsto
        \begin{bmatrix}
            1 & 0 & 0 & 0 \\
            0 & 0 & 1 & 0 \\
            0 & 1 & 0 & 0 \\
            0 & 0 & 0 & 1
        \end{bmatrix}
    \\
        \texttt{Empty} &\mapsto
        \begin{bmatrix}
            1
        \end{bmatrix}
    \\
        \texttt{Compose zx1 zx2} &\mapsto 
        \texttt{semantics(zx2)} \times \texttt{semantics(zx1)}
    \\
        \texttt{Stack zx1 zx2} &\mapsto
        \texttt{semantics(zx1)} \otimes \texttt{semantics(zx2)}
    \end{align*}
\end{frame}

\begin{frame}{Proportionality}

    To reason about \alert{equivalance} of diagrams, we define a relation using our semantics.
    \pause
    The relation is called \alert{\texttt{proportional}}, uses the symbol \alert{$\propto$}, and is defined as
    \[
        \exists c \neq 0: \texttt{semantics}(zx1) = c * \texttt{semantics}(zx2) \implies zx1 \propto zx2
    \]
    
    A relation allow us to use Coq's \alert{rewriting capabilities} in proofs.

\end{frame}

\begin{frame}{Rules}
      \begin{figure}
        \begin{subfigure}{.5\textwidth}
          \centering
          \textbf{Spider fusion}
        \end{subfigure}\begin{subfigure}{.5\textwidth}
          \centering
          \textbf{Hopf rule}
        \end{subfigure}

        \begin{subfigure}[t]{.5\textwidth}
          \centering
          \tikzfig{spider-fusion-1-1}
        \end{subfigure}\begin{subfigure}{.5\textwidth}
          \centering
          \tikzfig{hopf}
        \end{subfigure}
      \end{figure}

      \begin{figure}
        \centering
        \textbf{Bi-pi rule}

        \tikzfig{bi-pi}
      \end{figure}

\end{frame}

\begin{frame}{Rules}
    \begin{center}
        \textbf{Color Change bihadamard rule}

        \tikzfig{bihadamard}
    \end{center}
\end{frame}

\begin{frame}{Limitations}
    Using inductive definitions for the purposes of proof came at a cost.\pause

    Graphically, \alert{adjacency is obvious}. Our inductive definition \alert{buries} this information somewhere in Stack and Compose constructors.\pause

    The inductive \alert{Stack} and \alert{Compose} constructures also \alert{create new structural properties} such as associativity within stacks and distributivity of compose. 
\end{frame}

\begin{frame}{Rules: An example}
    \centering
    \tikzfig{stack-compose-comm}
\end{frame}

\begin{frame}{Summary}

         \alert{Why} should we care about verified tool kits for the ZX calculus?
         
         How we look at \alert{diagrams inductively}.
         
         How to encode \alert{semantics and equivalence} for our inductive diagrams.
         
         An example of how VyZX can be used to do diagram rewriting.


      \begin{figure}
        \centering
        \begin{subfigure}{0.6\textwidth}
          \begin{alertblock}{\centering GitHub}
            \centering
            \texttt{https://github.com/inQWIRE/VyZX}
          \end{alertblock}
        \end{subfigure}
      \end{figure}

\end{frame}

\end{document}
